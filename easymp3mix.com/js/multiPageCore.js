(()=>{"use strict";var e,t,r,o={674:(e,t,r)=>{r.d(t,{oO:()=>o,Qp:()=>n});const o={["mp3"]:1,["mp4"]:8,["avi"]:5,["mp4hd"]:7,["avihd"]:9},n={INITIALIZED:"initialized",PROGRESS:"progress",ERROR:"error",DONE:"done"}},769:(e,t,r)=>{r.d(t,{Y:()=>a});var o=r(674),n=r(570);const i={START:"start",PROGRESS:"progress",SUCCESS:"success",ERROR:"error"};class s{constructor(){const e={all:t=t||new Map,on:function(e,r){var o=t.get(e);o&&o.push(r)||t.set(e,[r])},off:function(e,r){var o=t.get(e);o&&o.splice(o.indexOf(r)>>>0,1)},emit:function(e,r){(t.get(e)||[]).slice().map((function(e){e(r)})),(t.get("*")||[]).slice().map((function(t){t(e,r)}))}};var t;Object.entries(e).forEach((([e,t])=>{this[e]=(...e)=>t(...e)})),this.EVENTS=i}async startConvert(e,t,r){try{if(!e)throw new Error("Incorrect URL!");if(!t)throw new Error("Incorrect format!");const{videoId:o,serviceId:s}=e;this.emit(i.START,{videoId:o,serviceId:s,formatId:t});const a=await(0,n.jO)(s,o,t),{convertKey:c,data:d,status:u}=a,{title:l,downloadUrl:m,rtbUrl:f}=await this.jerkOffProgress(u,d,c,r);this.emit(i.SUCCESS,{title:l,downloadUrl:m,rtbUrl:f})}catch(e){this.emit(i.ERROR,e)}}async jerkOffProgress(e,t,r,s){if(e===o.Qp.ERROR)throw new Error("Some thing is wrong, try reload page");if(e===o.Qp.DONE){const e=s?await(0,n.e4)():null;return{title:t.title,downloadUrl:t.downloadUrl,rtbUrl:e}}if([o.Qp.INITIALIZED,o.Qp.PROGRESS].includes(e)){if(!r)throw new Error("Missing convert key");return this.emit(i.PROGRESS,{progress:(t||{}).progress}),a=async()=>{const{data:e,status:t}=await(0,n.yS)(r);return this.jerkOffProgress(t,e,r,s)},c=2e3,new Promise(((e,t)=>{setTimeout((()=>{try{e(a())}catch(e){t(e)}}),c)}))}var a,c}}function a(e){if(!Boolean(e))return null;const t=e.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i);if(t)return{videoId:t[1],serviceId:"yt"};const r=e.match(/(?:facebook\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=))([\d]+)/i);if(r&&r[1])return{videoId:r[1],serviceId:"fb"};const o=e.match(/instagram.com\/p\/([a-z0-9_-]{11})/i);if(o)return{videoId:o[1],serviceId:"ig"};const n=e.match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/);return n?{videoId:n[5],serviceId:"vm"}:null}window.formConvertInit=function(e){const t=document.querySelector(e.form),r=t.querySelector(e.url),i=t.querySelector(e.format),c=e.withSubmitPopunder;if(!t||!t instanceof HTMLFormElement||!r||!i)throw new Error("Incorrect init config");const d=new s;return t.addEventListener("submit",(async t=>{t&&t.preventDefault();const s=a(r.value.trim()),u=i.value.trim(),l=o.oO[u],m=await(0,n.e4)();m&&c&&window.open(m,"_blank"),await d.startConvert(s,l,e.withPopunder)})),d},document.addEventListener("DOMContentLoaded",(()=>{"true"===sessionStorage.getItem("urlError")&&(window.yandexMetrikaEvent("URLerror"),sessionStorage.removeItem("urlError"))}))},570:(e,t,r)=>{r.d(t,{e4:()=>n,jO:()=>i,yS:()=>s});const o=(e,t)=>fetch(`https://easymp3mix.com/convert/${e.replace(/^\//,"")}`,Object.assign({},{cache:"no-cache",headers:{"Content-type":"application/json"}},t)).then((e=>e.json())).then((e=>"success"===e.status?Promise.resolve(e.data):Promise.reject(new Error(e.msg||(e.data||{}).msg||"Invalid api response")))),n=async()=>{try{const e=await o("/get-rtb-url");return await fetch(e.data,{cache:"no-cache",headers:{"Content-type":"application/json"}}).then((e=>e.json())).then((e=>"success"===e.status?e.data.rtbInfo.url:null))}catch(e){return null}},i=(e,t,r)=>o("/init",{method:"POST",body:JSON.stringify({serviceId:e,videoId:t,formatId:r})}),s=e=>o(`/status?convertKey=${e}`)}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return o[e](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=i(674),t=i(769),r=i(570),window.formConvertInit=function(o){const n=document.querySelector(o.form),i=n.querySelector(o.url),s=n.querySelector(o.format),a=o.withSubmitPopunder;if(!n||!n instanceof HTMLFormElement||!i||!s)throw new Error("Incorrect init config");n.addEventListener("submit",(async n=>{n&&n.preventDefault(),window.yandexMetrikaEvent("pushconvert");const c=(0,t.Y)(i.value.trim()),d=s.value.trim(),u=e.oO[d],l=await(0,r.e4)();l&&a&&window.open(l,"_blank"),localStorage.setItem("conv",JSON.stringify({parsedUrl:c,formatId:u,withPopunder:o.withPopunder})),window.yandexMetrikaEvent("progress"),window.location.replace(`${window.location.href}/progress`)}))}})();